# Registration of segmentation of external layers


To analyze the results from segmentation layers of your images within the context of the atlas-aligned image, allow you to import external layers that will be analyzed by brainreg-segment.

This layer will be then segmented as a 3D \(or 2D\) structure, such as area covering all your bulk axonal projections of interes analyzed by a binary mask.  


Select the `Region Segmentation` button in the `Segmentation panel`.

![Segmenting a 2/3D structure](../../.gitbook/assets/region_seg%20%281%29.png)

You can register to the atlas the coordinates of segmentations done using other napari pluggins or mask generated in other proggrams that you can save as a tiff. Meaning been able to "import" these results into brainreg-segment so that they can be analysed in the context of the atlas. To get your segmented structures register to the atlas your segmentation plugging must be run in the _downsample channel of interest generated by brainreg. 

Select the `Region Segmentation` button in the `Segmentation panel`.

{% hint style="info" %}
![Segmenting a 2/3D structure](../../.gitbook/assets/region_seg%20%281%29.png)
{% endhint %}

To load your data

* Load project (sample space) - This is for loading a brainreg project in the coordinate space of your raw data (i.e not warped to the atlas space). 

Then: 
* Open as a layer in Napari the .tiff file  with your segmentation of interest or mask that you want to use for the registration to the atlas
* For example your segmentation can be done by simpleitk plugin or using other napari pluggins that run using a deep learning-based segmentation algorithms 

* Select the channel of interest and use one of the segmentation plugins in napari
        * You might need to install these pluggings  [napari pluggins ] (https://github.com/haesleinhuepf/napari-simpleitk-image-processing) you can also use the gui installing the napari assistant(https://www.napari-hub.org/plugins/napari-assistant)   
        * You can then load the different options by navigating to Plugins ->  or Tools ->.  Some details of the different segmentation options developed in napari based on fluorescence microscopy can be found here https://github.com/haesleinhuepf/napari-segment-blobs-and-things-with-membranes
* Navigate to where you want to draw your region of interest.

You can have an overview of some examples here 

*Use https://github.com/clEsperanto/napari_pyclesperanto_assistant
*Use https://github.com/haesleinhuepf/napari-skimage-regionprops




 in napari viewer or externally if prefered add the layer that contains the mask image that is going to be used for segmentation
	tools --> segmentation binary -->threshold otsu
	number of thresholds -7 number of histogram bins -256 
	details for parameter selection can be found in https://scikit-image.org/docs/stable/auto_examples/segmentation/plot_multiotsu.html



Otsu_thresch_splitLayers.ipynb

- open the generated layers in a napari window in which the brainreg-segment pluggin is open 
	- over the generated images run in pluggings the otsu thrshold over each of the layer
-Click the botton add layer from select and proceed to get the data
- Click analyse regions, wait in the terminal window until Finish line is shown
-- now run in matlab the classification - located in /mnt/smederos/Sofware/Code2022/Anatomy/processBrainRegMSeg.m


Then:
* Open the brainreg-segment plugin
* Open the region segmentation panel
* Used an external plugin to segment the data. Imported the output of the external plugin by selecting it's output layer
* Click the `Add region from existing layer` button
* If required, rename this region 


* Add a new region if required 
* Repeat above for each region you wish to segment.
* Click `Analyse regions` to analyse the spatial distribution of the regions you have drawn (as done for the 3D structures segmentation).
  * If `Calculate volumes` is selected, the volume of each brain area included in the segmented region will be calculated and saved.
  * If `Summarise volumes` is selected, then each region will be summarised \(centers, volumes etc\)







{% hint style="info" %}
All data will be saved into your brainreg output directory
{% endhint %}